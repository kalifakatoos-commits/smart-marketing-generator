<div class="max-w-4xl mx-auto">
  <div class="bg-gray-800 p-8 rounded-lg shadow-2xl">
    <h2 class="text-3xl font-bold mb-2 text-center">إنشاء صورة من نص</h2>
    <p class="text-center text-gray-400 mb-6">صف الصورة التي تريد إنشاءها. كن مفصلاً قدر الإمكان للحصول على أفضل
      النتائج.</p>

    <div class="space-y-6">
      <div>
        <div class="flex justify-between items-center mb-1">
          <label for="prompt" class="block text-sm font-medium text-gray-300">الموجه الخاص بك</label>
          <button (click)="enhancePrompt()" [disabled]="isEnhancing() || !prompt()"
            class="text-xs bg-gray-700 hover:bg-gray-600 text-blue-400 px-2 py-1 rounded transition-colors flex items-center gap-1 disabled:opacity-50">
            @if (isEnhancing()) {
            <div class="animate-spin h-3 w-3 border-b-2 border-blue-400 rounded-full"></div>
            } @else {
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z">
              </path>
            </svg>
            }
            تحسين الأمر
          </button>
        </div>
        <textarea id="prompt" name="prompt" rows="3"
          class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-white"
          [value]="prompt()" (input)="onPromptChange($event)"></textarea>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">نمط الصورة</label>
        <div class="mt-2 flex flex-wrap gap-2">
          @for (style of styles; track style.id) {
          <button (click)="onStyleChange(style.id)"
            [class]="'px-3 py-1.5 text-xs font-medium rounded-full border transition-all ' + (selectedStyle() === style.id ? 'bg-blue-600/20 border-blue-500 text-blue-400' : 'bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-600')">
            {{ style.name }}
          </button>
          }
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">نسبة العرض إلى الارتفاع</label>
        <div class="mt-2 flex flex-wrap gap-2">
          @for (ratio of aspectRatios; track ratio.value) {
          <button (click)="onAspectRatioChange(ratio.value)"
            [class]="'px-4 py-2 text-sm font-medium rounded-md transition-colors ' + (aspectRatio() === ratio.value ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600')">
            {{ ratio.label }}
          </button>
          }
        </div>
      </div>

      <div class="flex items-center gap-2 mb-4">
        <input type="checkbox" id="sendToWebhook" [checked]="sendToWebhook()"
          (change)="sendToWebhook.set(!sendToWebhook())"
          class="rounded border-gray-700 bg-gray-800 text-blue-600 focus:ring-blue-500">
        <label for="sendToWebhook" class="text-sm text-gray-400 cursor-pointer select-none">إرسال النتيجة إلى
          Webhook</label>
      </div>

      <button (click)="generateImage()" [disabled]="isLoading() || !prompt()"
        class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-500 disabled:cursor-not-allowed">
        @if (isLoading()) {
        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
        } @else {
        <span>إنشاء</span>
        }
      </button>

      @if (error()) {
      <p class="text-red-400 text-sm mt-2 text-center">{{ error() }}</p>
      }

      <div class="bg-gray-900 p-4 rounded-lg min-h-[400px] flex items-center justify-center">
        @if (isLoading()) {
        <app-loading-spinner type="skeleton-image" message="...جاري إنشاء تحفتك الفنية" />
        } @else if (generatedImage()) {
        <div class="relative group">
          <img [src]="generatedImage()" alt="Generated image"
            class="max-h-[500px] w-auto object-contain rounded-md shadow-lg" />
          <button (click)="downloadImage()"
            class="absolute bottom-4 right-4 bg-gray-900/80 hover:bg-blue-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center gap-2 px-4 backdrop-blur-sm"
            title="تحميل">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            <span class="text-sm font-medium">تحميل</span>
          </button>
        </div>
        } @else {
        <div class="text-center text-gray-500">
          <p>ستظهر صورتك التي تم إنشاؤها هنا.</p>
        </div>
        }
      </div>
    </div>
  </div>
</div>