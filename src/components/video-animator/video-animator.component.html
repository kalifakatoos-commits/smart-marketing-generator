<div class="max-w-4xl mx-auto">
  <div class="bg-gray-800 p-8 rounded-lg shadow-2xl">
    <h2 class="text-3xl font-bold mb-2 text-center">تحريك الصورة باستخدام Veo</h2>
    <p class="text-center text-gray-400 mb-6">أضف الحياة إلى صورك الثابتة. قم بتحميل صورة، وصف الحركة المطلوبة، وأنشئ
      فيديو قصيرًا.</p>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Left Column: Input -->
      <div class="space-y-6">
        <div>
          <label for="image-upload-animator" class="block text-sm font-medium text-gray-300 mb-2">١. تحميل
            الصورة</label>
          <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-600 border-dashed rounded-md">
            <div class="space-y-1 text-center">
              @if (imagePreview()) {
              <img [src]="imagePreview()" alt="Image preview" class="mx-auto h-32 w-auto object-contain rounded-md" />
              } @else {
              <label for="image-upload-animator"
                class="relative cursor-pointer bg-gray-800 rounded-md font-medium text-blue-400 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-offset-gray-800 focus-within:ring-blue-500">
                <svg class="mx-auto h-12 w-12 text-gray-500" stroke="currentColor" fill="none" viewBox="0 0 48 48"
                  aria-hidden="true">
                  <path
                    d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <p class="text-sm text-gray-400">انقر للتحميل</p>
                <p class="text-xs text-gray-500">PNG, JPG, GIF, WEBP</p>
              </label>
              }
              <input id="image-upload-animator" name="image-upload-animator" type="file" class="sr-only"
                (change)="onFileSelected($event)" accept="image/png,image/jpeg,image/gif,image/webp">
            </div>
          </div>
        </div>

        <div>
          <label for="prompt" class="block text-sm font-medium text-gray-300">٢. موجه التحريك</label>
          <textarea id="prompt" name="prompt" rows="3"
            class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm text-white"
            [value]="prompt()" (input)="onPromptChange($event)"></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300">٣. نسبة العرض إلى الارتفاع</label>
          <div class="mt-2 flex gap-2">
            <button (click)="onAspectRatioChange('16:9')"
              [class]="'px-4 py-2 text-sm font-medium rounded-md transition-colors ' + (aspectRatio() === '16:9' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600')">
              أفقي (16:9)
            </button>
            <button (click)="onAspectRatioChange('9:16')"
              [class]="'px-4 py-2 text-sm font-medium rounded-md transition-colors ' + (aspectRatio() === '9:16' ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600')">
              عمودي (9:16)
            </button>
          </div>
        </div>

        <div class="flex items-center gap-2 mb-4">
          <input type="checkbox" id="sendToWebhook" [checked]="sendToWebhook()"
            (change)="sendToWebhook.set(!sendToWebhook())"
            class="rounded border-gray-700 bg-gray-800 text-blue-600 focus:ring-blue-500">
          <label for="sendToWebhook" class="text-sm text-gray-400 cursor-pointer select-none">إرسال النتيجة إلى
            Webhook</label>
        </div>

        <button (click)="animateImage()" [disabled]="isLoading() || !imagePreview()"
          class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-500 disabled:cursor-not-allowed">
          @if (isLoading()) {
          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
          } @else {
          <span>تحريك الصورة</span>
          }
        </button>

        @if (error()) {
        <p class="text-red-400 text-sm mt-2 text-center">{{ error() }}</p>
        }
      </div>

      <!-- Right Column: Output -->
      <div class="bg-gray-900 p-2 rounded-lg min-h-[300px] flex items-center justify-center">
        @if (isLoading()) {
        <app-loading-spinner type="skeleton-image" [message]="loadingMessage()" />
        } @else if (generatedVideoUrl()) {
        <div class="relative group w-full flex justify-center">
          <video [src]="generatedVideoUrl()" controls autoplay loop
            class="max-w-full max-h-[500px] rounded-md shadow-lg">
            Your browser does not support the video tag.
          </video>
          <button (click)="downloadVideo()"
            class="absolute top-4 right-4 bg-gray-900/80 hover:bg-blue-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 flex items-center gap-2 px-4 backdrop-blur-sm"
            title="تحميل">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
            </svg>
            <span class="text-sm font-medium">تحميل</span>
          </button>
        </div>
        } @else {
        <div class="text-center text-gray-500">
          <p>سيظهر الفيديو المتحرك الخاص بك هنا.</p>
        </div>
        }
      </div>
    </div>
  </div>
</div>